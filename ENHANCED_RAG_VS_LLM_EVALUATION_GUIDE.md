# å¢å¼ºçš„RAG vs LLMè¯„ä¼°ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ¯ æ–°å¢åŠŸèƒ½

æœ¬æ¬¡æ›´æ–°ä¸º `rag_vs_llm_evaluation.py` æ·»åŠ äº†ä»¥ä¸‹é‡è¦åŠŸèƒ½ï¼š

### 1. æ£€ç´¢æ€§èƒ½åŸ‹ç‚¹
- **Precision@k**: æ£€ç´¢ç»“æœä¸­ç›¸å…³æ–‡æ¡£çš„æ¯”ä¾‹
- **Recall@k**: æ£€ç´¢åˆ°çš„ç›¸å…³æ–‡æ¡£å æ€»ç›¸å…³æ–‡æ¡£çš„æ¯”ä¾‹  
- **nDCG@k**: å½’ä¸€åŒ–æŠ˜æŸç´¯ç§¯å¢ç›Šï¼Œè€ƒè™‘æ’åºè´¨é‡

æ”¯æŒçš„kå€¼ï¼š1, 3, 5

### 2. ç®€åŒ–é—®ç­”è®°å½•
ç”Ÿæˆ `.jsonl` æ ¼å¼çš„ç®€åŒ–è®°å½•æ–‡ä»¶ï¼Œæ¯è¡ŒåŒ…å«ï¼š
```json
{
  "question": "é—®é¢˜å†…å®¹",
  "expected_answer": "æ ‡å‡†ç­”æ¡ˆ", 
  "rag_answer": "RAGç³»ç»Ÿç­”æ¡ˆ",
  "llm_answer": "çº¯LLMç­”æ¡ˆ"
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿè¯„ä¼°ï¼ˆæ¨èï¼‰
```bash
python rag_vs_llm_evaluation.py --mode quick --sample-size 20
```

### å®Œæ•´è¯„ä¼°
```bash
python rag_vs_llm_evaluation.py --mode full --qa-path qa_datasets
```

### æµ‹è¯•æ–°åŠŸèƒ½
```bash
python test_enhanced_rag_vs_llm_evaluation.py
```

## ğŸ“Š è¾“å‡ºæ–‡ä»¶è¯´æ˜

è¿è¡Œè¯„ä¼°åä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

### 1. å®Œæ•´ç»“æœæ–‡ä»¶
- **æ–‡ä»¶å**: `rag_vs_llm_full_results_{timestamp}.json`
- **å†…å®¹**: åŒ…å«æ‰€æœ‰è¯¦ç»†è¯„ä¼°æ•°æ®ï¼ŒåŒ…æ‹¬æ£€ç´¢æŒ‡æ ‡

### 2. æ±‡æ€»ç»“æœæ–‡ä»¶  
- **æ–‡ä»¶å**: `rag_vs_llm_summary_{timestamp}.json`
- **å†…å®¹**: ç»Ÿè®¡æ±‡æ€»ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ£€ç´¢æ€§èƒ½ç»Ÿè®¡

### 3. ç®€åŒ–é—®ç­”è®°å½• â­ æ–°å¢
- **æ–‡ä»¶å**: `simple_qa_records_{timestamp}.jsonl`
- **æ ¼å¼**: æ¯è¡Œä¸€ä¸ªJSONå¯¹è±¡
- **ç”¨é€”**: ä¾¿äºåç»­åˆ†æå’Œå¤„ç†

### 4. é—®ç­”å¯¹æ¯”æ–‡ä»¶
- **JSONæ ¼å¼**: `rag_vs_llm_qa_comparison_{timestamp}.json`
- **æ–‡æœ¬æ ¼å¼**: `rag_vs_llm_qa_comparison_{timestamp}.txt`
- **CSVæ ¼å¼**: `rag_vs_llm_qa_comparison_{timestamp}.csv`

### 5. MarkdownæŠ¥å‘Š
- **æ–‡ä»¶å**: `rag_vs_llm_report_{timestamp}.md`
- **å†…å®¹**: åŒ…å«æ£€ç´¢æŒ‡æ ‡çš„ç¾è§‚æŠ¥å‘Š

## ğŸ“ˆ æ£€ç´¢æŒ‡æ ‡è¯´æ˜

### Precision@k
- **å®šä¹‰**: å‰kä¸ªæ£€ç´¢ç»“æœä¸­ç›¸å…³æ–‡æ¡£çš„æ¯”ä¾‹
- **è®¡ç®—**: ç›¸å…³æ–‡æ¡£æ•° / k
- **èŒƒå›´**: [0, 1]ï¼Œè¶Šé«˜è¶Šå¥½

### Recall@k  
- **å®šä¹‰**: å‰kä¸ªæ£€ç´¢ç»“æœä¸­æ£€ç´¢åˆ°çš„ç›¸å…³æ–‡æ¡£å æ€»ç›¸å…³æ–‡æ¡£çš„æ¯”ä¾‹
- **è®¡ç®—**: æ£€ç´¢åˆ°çš„ç›¸å…³æ–‡æ¡£æ•° / æ€»ç›¸å…³æ–‡æ¡£æ•°
- **èŒƒå›´**: [0, 1]ï¼Œè¶Šé«˜è¶Šå¥½

### nDCG@k
- **å®šä¹‰**: å½’ä¸€åŒ–æŠ˜æŸç´¯ç§¯å¢ç›Šï¼Œè€ƒè™‘æ–‡æ¡£æ’åºä½ç½®
- **ç‰¹ç‚¹**: æ’åºè¶Šé å‰çš„ç›¸å…³æ–‡æ¡£æƒé‡è¶Šé«˜
- **èŒƒå›´**: [0, 1]ï¼Œè¶Šé«˜è¶Šå¥½

## ğŸ”§ ç›¸å…³æ€§åˆ¤æ–­æœºåˆ¶

ç³»ç»Ÿä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åˆ¤æ–­æ£€ç´¢æ–‡æ¡£çš„ç›¸å…³æ€§ï¼š

1. **æ–‡æœ¬æå–**: ä»æ£€ç´¢é¡¹ä¸­æå–æ–‡æœ¬å†…å®¹
2. **è¯æ±‡é‡å **: è®¡ç®—ä¸æœŸæœ›ç­”æ¡ˆçš„è¯æ±‡é‡å åº¦
3. **é˜ˆå€¼åˆ¤æ–­**: é‡å åº¦ > 0.1 è§†ä¸ºç›¸å…³æ–‡æ¡£
4. **åˆ†æ•°è®¡ç®—**: åŸºäºé‡å åº¦è®¡ç®—è¿ç»­ç›¸å…³æ€§åˆ†æ•°

## ğŸ“‹ ç¤ºä¾‹è¾“å‡º

### æ§åˆ¶å°æŠ¥å‘Š
```
ğŸ¯ RAGæ£€ç´¢æ€§èƒ½æŒ‡æ ‡:
----------------------------------------
  Precision@1: 0.3333 (Â±0.4714)
  Precision@3: 0.1111 (Â±0.1571)  
  Precision@5: 0.2000 (Â±0.1633)
  Recall@1: 0.3333 (Â±0.4714)
  Recall@3: 0.3333 (Â±0.4714)
  Recall@5: 0.6667 (Â±0.4714)
  nDCG@1: 0.3333 (Â±0.4714)
  nDCG@3: 0.3333 (Â±0.4714)
  nDCG@5: 0.5004 (Â±0.4082)
```

### ç®€åŒ–é—®ç­”è®°å½•ç¤ºä¾‹
```jsonl
{"question": "Who is the leader of Belgium?", "expected_answer": "Alexander De Croo", "rag_answer": "Philippe of Belgium", "llm_answer": "King Philippe"}
{"question": "What is the capital of Netherlands?", "expected_answer": "Amsterdam", "rag_answer": "Eberhard van der Laan", "llm_answer": "Amsterdam"}
```

## âš™ï¸ é…ç½®é€‰é¡¹

### æ£€ç´¢æŒ‡æ ‡é…ç½®
å¯ä»¥åœ¨ `calculate_retrieval_metrics` æ–¹æ³•ä¸­ä¿®æ”¹ï¼š
- `k_values`: è¦è®¡ç®—çš„kå€¼åˆ—è¡¨ï¼Œé»˜è®¤ [1, 3, 5]
- ç›¸å…³æ€§é˜ˆå€¼: é»˜è®¤ 0.1ï¼Œå¯æ ¹æ®éœ€è¦è°ƒæ•´

### è¾“å‡ºç›®å½•
é»˜è®¤è¾“å‡ºåˆ° `evaluation/` ç›®å½•ï¼Œå¯é€šè¿‡å‚æ•°ä¿®æ”¹ï¼š
```python
evaluator.save_evaluation_results(results, output_dir="custom_output")
```

## ğŸ” æ•…éšœæ’é™¤

### 1. æ£€ç´¢æŒ‡æ ‡å…¨ä¸º0
- **åŸå› **: æ£€ç´¢æ–‡æ¡£ä¸æœŸæœ›ç­”æ¡ˆç›¸å…³æ€§å¤ªä½
- **è§£å†³**: æ£€æŸ¥æ•°æ®è´¨é‡æˆ–è°ƒæ•´ç›¸å…³æ€§é˜ˆå€¼

### 2. ç®€åŒ–è®°å½•æ–‡ä»¶ä¸ºç©º
- **åŸå› **: è¯„ä¼°è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸
- **è§£å†³**: æ£€æŸ¥æ—¥å¿—è¾“å‡ºï¼Œç¡®è®¤è¯„ä¼°æ­£å¸¸å®Œæˆ

### 3. LLMè°ƒç”¨å¤±è´¥
- **åŸå› **: APIå¯†é’¥æœªè®¾ç½®æˆ–ç½‘ç»œé—®é¢˜
- **è§£å†³**: æ£€æŸ¥ `config.py` ä¸­çš„ `OPENAI_API_KEY` è®¾ç½®

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `rag_vs_llm_evaluation.py`: ä¸»è¯„ä¼°ç³»ç»Ÿ
- `test_enhanced_rag_vs_llm_evaluation.py`: æµ‹è¯•è„šæœ¬
- `enhanced_retrieval_engine.py`: RAGæ£€ç´¢å¼•æ“
- `config.py`: é…ç½®æ–‡ä»¶

## ğŸ‰ æ€»ç»“

æ–°å¢çš„åŸ‹ç‚¹åŠŸèƒ½è®©ä½ èƒ½å¤Ÿï¼š
1. **æ·±å…¥åˆ†æ**: äº†è§£RAGç³»ç»Ÿçš„æ£€ç´¢æ€§èƒ½
2. **ä¾¿æ·å¤„ç†**: è·å¾—ç®€åŒ–çš„é—®ç­”è®°å½•ç”¨äºåç»­åˆ†æ
3. **å…¨é¢è¯„ä¼°**: ä»æ£€ç´¢åˆ°ç”Ÿæˆçš„ç«¯åˆ°ç«¯æ€§èƒ½è¯„ä¼°

è¿™äº›æ”¹è¿›è®©è¯„ä¼°ç³»ç»Ÿæ›´åŠ å®Œå–„ï¼Œä¸ºRAGç³»ç»Ÿä¼˜åŒ–æä¾›æ›´å¤šæ•°æ®æ”¯æŒï¼